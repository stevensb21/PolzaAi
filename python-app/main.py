import asyncio
import requests
from polza_SDK import PolzaConfig, Agent, Runner

PolzaConfig.configure(api_key="ak_XfE3O425uoSp2I3xiLDJXmOX7xGLF3BZ1uXUImXxnpo")

def handle_tool_call(tool_name, arguments):
    import requests
    if tool_name == "call_people_api":
        query = arguments.get("query")
        response = requests.get("http://80.87.193.89:8081/api/people")
        data = response.json()
        
        return data
    else:
        return {"error": "Unknown tool"}


search_agent = Agent(
    name="search_agent",
    model="openai/gpt-4o-mini",   # —Ç–≤–æ–π –ø—Ä–æ–∫—Å–∏
    instructions="""
        –¢—ã ‚Äî –∞–≥–µ–Ω—Ç –ø–æ–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.
        –¢–≤–æ—è –∑–∞–¥–∞—á–∞: –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã—Ö –ª—é–¥–µ–π –≤ JSON,
        –ø–æ–ª—É—á–∞–µ–º—ã–π –ø–æ http://80.87.193.89:8081/api/people.
        - –ò—â–∏ –ø–æ –§–ò–û, –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é.
        - –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Üí –≤–µ—Ä–Ω–∏ —Å–ø–∏—Å–æ–∫.
        - –ï—Å–ª–∏ –æ–¥–∏–Ω ‚Üí –≤–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ –µ–≥–æ.
        - –ï—Å–ª–∏ –Ω–∏–∫–æ–≥–æ ‚Üí –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ.
    """,
    tools=[
        {
            "name": "call_people_api",
            "description": "–ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ API. –ü–∞—Ä–∞–º–µ—Ç—Ä: query=—Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞",
            "parameters": {
                "query": "—Å—Ç—Ä–æ–∫–∞ —Å –§–ò–û –∏–ª–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å—é"
            }
        }
    ],
)

# üìã –ê–≥–µ–Ω—Ç –≤—ã–≤–æ–¥–∞
output_agent = Agent(
    name="output_agent",
    model="openai/gpt-4.1-mini",
    instructions="""
        –≤—ã–≤–µ–¥–∏ –≤—Å–µ —á—Ç–æ —Ç–µ–±–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç
    """,
    tools=[],
)

# üìù –ê–≥–µ–Ω—Ç –∑–∞—è–≤–æ–∫
request_agent = Agent(
    name="request_agent",
    model="openai/gpt-4.1-mini",
    instructions="""
        –¢—ã ‚Äî –∞–≥–µ–Ω—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞—è–≤–æ–∫.
        –ó–∞–¥–∞—á–∞: —Å–æ–±—Ä–∞—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ (–§–ò–û, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è, –°–ù–ò–õ–°, –ò–ù–ù, —Ç–µ–ª–µ—Ñ–æ–Ω, —Ñ–æ—Ç–æ).
        - –ï—Å–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–∞–π–¥–µ–Ω ‚Üí –ø—Ä–µ–¥–ª–æ–∂–∏ –≤—ã–±—Ä–∞—Ç—å —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è (–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ, —Å–∫–æ—Ä–æ –ø—Ä–æ—Å—Ä–æ—á–∞—Ç—Å—è, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ).
        - –ï—Å–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç ‚Üí —Å–æ–±–µ—Ä–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ.
        - –ö–æ–≥–¥–∞ –≤—Å—ë –≥–æ—Ç–æ–≤–æ ‚Üí —Å—Ñ–æ—Ä–º–∏—Ä—É–π –∑–∞—è–≤–∫—É –∏ –ø–µ—Ä–µ–¥–∞–π –µ—ë –∞–≥–µ–Ω—Ç—É —Å–æ–æ–±—â–µ–Ω–∏–π.
    """,
    tools=[],
)

# üì© –ê–≥–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
message_agent = Agent(
    name="message_agent",
    model="openai/gpt-4.1-mini",
    instructions="""
        –¢—ã ‚Äî –∞–≥–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.
        –ó–∞–¥–∞—á–∞: –≤–∑—è—Ç—å –≥–æ—Ç–æ–≤—É—é –∑–∞—è–≤–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—ë –õ–∞—Ä–∏—Å–µ —á–µ—Ä–µ–∑ tool send_message.
    """,
    tools=[],
)

# ==== –≥–ª–∞–≤–Ω—ã–π –∞–≥–µ–Ω—Ç (–¥–∏—Å–ø–µ—Ç—á–µ—Ä) ====

async def main():
    dispatcher_agent = Agent(
        name="dispatcher_agent",
        model="openai/gpt-4.1-mini",
        instructions="""
            –¢—ã ‚Äî –¥–∏—Å–ø–µ—Ç—á–µ—Ä.
            –ó–∞–¥–∞—á–∞: –ø–æ–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—ã–∑–≤–∞—Ç—å –Ω—É–∂–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞.

            –ü—Ä–∞–≤–∏–ª–∞:
            - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —Å–≤—è–∑–∞–Ω —Å –ø–æ–∏—Å–∫–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–ª–∏ "–ø–æ–∫–∞–∂–∏", "–Ω–∞–π–¥–∏", "–≤—ã–≤–µ–¥–∏" ‚Üí –≤—ã–∑–æ–≤–∏ search_agent, –ø–æ—Ç–æ–º output_agent.
            - –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å = "—Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É" ‚Üí –≤—ã–∑–æ–≤–∏ search_agent, –ø–æ—Ç–æ–º request_agent, –ø–æ—Ç–æ–º message_agent.
            - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ ‚Üí —É—Ç–æ—á–Ω–∏, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ.
        """,
        tools=[
            search_agent.as_tool(tool_name="search_agent", tool_description="–ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤"),
            output_agent.as_tool(tool_name="output_agent", tool_description="–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"),
            request_agent.as_tool(tool_name="request_agent", tool_description="–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏"),
            message_agent.as_tool(tool_name="message_agent", tool_description="–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è")
        ],
    )

async def main():
    result = await Runner.run(search_agent, "–ü–æ–∫–∞–∂–∏ –≤—Å–µ—Ö –ï–≥–æ—Ä–æ–≤–∞")
    print(result)

asyncio.run(main())
